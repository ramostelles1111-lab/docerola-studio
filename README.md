<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Docerola Studio</title>
  <!-- Tailwind CDN (r√°pido para demo). Para producci√≥n conviene compilar Tailwind o usar CSS propio -->
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="min-h-screen bg-slate-900 text-white">
  <div id="root"></div>

  <!-- Si tu JS exporta como componente React, necesitas React + ReactDOM -->
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>

  <!-- Libraries CDN (opcionales si tu minificado ya hace import din√°mico) -->
  <script src="https://cdn.jsdelivr.net/npm/tone@14.7.77/build/Tone.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/midiwriter-js@2.1.0/build/index.umd.js"></script>

  <!-- Tu c√≥digo minificado (aseg√∫rate que DocerolaStudio.min.js exporte/monte la app en #root) -->
  <script src="DocerolaStudio.min.js"></script>

  <!-- Si tu bundle exporta un componente, usa este peque√±o bootstrapper -->
  <script>
    // Si tu minificado deja un componente global, por ejemplo window.DocerolaStudioMount,
    // llama aqu√≠ a la funci√≥n de montaje. Si tu minificado ya lo monta, puedes eliminar este bloque.
    if (window.DocerolaStudioMount && document.getElementById('root')) {
      window.DocerolaStudioMount(document.getElementById('root'));
    } else if (window.DocerolaStudio) {
      // ejemplo: si exportaste un componente React como window.DocerolaStudio
      const e = React.createElement;
      ReactDOM.createRoot(document.getElementById('root')).render(e(window.DocerolaStudio));
    }
  </script>
</body>
</html>
<script src="DocerolaStudio.min.js"></script>
importReact,{useState,useRef,useEffect}from"react";//DocerolaStudio-Single-fileReactcomponent(corregido)//-UsaTailwindCSSparaestilos(necesitasincluirTailwindentuproyecto)//-UsaCDNparaTone.jsymidiwriter-js(siprefieres,a√±ade<script>enindex.htmlcomoindicamos)//-Estearchivoest√°preparadoparasubiralaweb(single-fileReactcomponent).exportdefaultfunctionDocerolaStudio(){const[lyrics,setLyrics]=useState("Escribeaqu√≠laletradetucanci√≥n...\n(Soportavariasl√≠neas)");const[generated,setGenerated]=useState({notes:[],tabs:""});const[isPlaying,setIsPlaying]=useState(false);const[scale,setScale]=useState("G_major");const[bpm,setBpm]=useState(90);constaudioCtxRef=useRef(null);const[voiceSample,setVoiceSample]=useState(null);const[pitchHz,setPitchHz]=useState(null);const[downloadUrl,setDownloadUrl]=useState(null);useEffect(()=>{//lazy-loadAudioContextif(!audioCtxRef.current){audioCtxRef.current=new(window.AudioContext||window.webkitAudioContext)();}},[]);//======Utilities======functionsyllablesFromText(text){//heur√≠sticasimple:dividirpors√≠labasusandovocalesagrupadas(muyb√°sica)returntext.replace(/\n/g,"").split(/\s+/).filter(Boolean).map((w)=>{//splitintovowelgroups(muysimple)constparts=w.match(/[aeiou√°√©√≠√≥√∫√º]+/gi);if(!parts)return[w];returnparts;}).flat();}constSCALES={G_major:["G3","A3","B3","C4","D4","E4","F#4","G4"],E_minor:["E3","F#3","G3","A3","B3","C4","D4","E4"],A_minor:["A3","B3","C4","D4","E4","F4","G4","A4"],};functionmapSyllablesToNotes(syllables,scaleName){constscaleNotes=SCALES[scaleName]||SCALES["G_major"];constnotes=syllables.map((s,i)=>{constidx=i%scaleNotes.length;//varyrhythmdependiendodelongituddelas√≠labaconstdur=s.length>2?"4n":"8n";return{note:scaleNotes[idx],dur};});returnnotes;}functiongenerateFromLyrics(){constsyl=syllablesFromText(lyrics);constnotes=mapSyllablesToNotes(syl,scale);consttabs=makeSimpleTabsFromNotes(notes);setGenerated({notes,tabs});}functionmakeSimpleTabsFromNotes(notes){//Parademo:creal√≠neasdetablaturaconlacuerda1-6(duplicadasparadocerola)//Nota:estoesdemostrativo.Paratablaturasrealesrecomendar√≠acalcularposicionesdesdelanotaMIDI.conststrings=["e'","B","G","D","A","E"];//simplificadoconstmeasures=[];notes.forEach((n,i)=>{//placeholder:usael√≠ndiceparageneraruntrastelegible(0-11)constfret=i%12;constline=strings.map((s)=>(i%4===0?`-${fret}-`:"--"));measures.push(line.join(""));});return["Tablatura(demo)forDocerola(12cuerdas):",...measures].join("\n");}//=====PlaybackusingTone.js(CDNexpected)=====asyncfunctionplayGenerated(){if(!generated.notes||generated.notes.length===0)returnalert('Generalam√∫sicaprimero.');setIsPlaying(true);try{//dynamicimport‚ÄîUMDmodulessometimesattachtowindow,as√≠queintentamosambasopcionesconsttoneModule=awaitimport('https://cdn.jsdelivr.net/npm/tone@14.7.77/build/Tone.js');constTone=(toneModule&&(toneModule.default||toneModule.Tone))||window.Tone||toneModule;if(!Tone)thrownewError('NosepudocargarTone.js.A√±adelaetiqueta<script>enindex.htmlopermiteimportsdesdeCDN.');awaitTone.start();Tone.Transport.bpm.value=bpm;constsynth=newTone.Synth().toDestination();lettime=0;generated.notes.forEach((n)=>{//Toneaccepts'4n'/'8n'whenschedulingviaTransport;cuandousamosabsolutetimefuncionar√°comoduraci√≥n.synth.triggerAttackRelease(n.note,n.dur,Tone.now()+time);time+=n.dur==='4n'?(60/bpm):(60/bpm)/2;//aproximaci√≥n});//marcarfinsetTimeout(()=>setIsPlaying(false),time*1000+300);}catch(err){console.error(err);alert('ErroralcargarTone.jsoreproducir:'+err.message);setIsPlaying(false);}}//=====Voiceanalysis(pitchdetection)=====functionhandleVoiceFile(e){constfile=e.target.files[0];if(!file)return;setVoiceSample(file);constreader=newFileReader();reader.onload=async(ev)=>{try{constarrayBuffer=ev.target.result;constaudioCtx=audioCtxRef.current||new(window.AudioContext||window.webkitAudioContext)();constaudioBuffer=awaitaudioCtx.decodeAudioData(arrayBuffer.slice(0));constfloatData=audioBuffer.getChannelData(0);constpitch=autoCorrelate(floatData,audioCtx.sampleRate);setPitchHz(pitch?Math.round(pitch):'‚Äî');}catch(err){console.error(err);alert('Nosepudoanalizarelarchivodeaudio.');}};reader.readAsArrayBuffer(file);}//Simpleautocorrelationpitchdetection(fromChrisWilsonexamples)functionautoCorrelate(buf,sampleRate){//ImplementationsimplifiedfordemoletSIZE=buf.length;letrms=0;for(leti=0;i<SIZE;i++){constval=buf[i];rms+=val*val;}rms=Math.sqrt(rms/SIZE);if(rms<0.01)returnnull;//tooquietletr1=0,r2=SIZE-1,thres=0.2;for(leti=0;i<SIZE/2;i++)if(Math.abs(buf[i])<thres){r1=i;break;}for(leti=1;i<SIZE/2;i++)if(Math.abs(buf[SIZE-i])<thres){r2=SIZE-i;break;}buf=buf.slice(r1,r2);SIZE=buf.length;constc=newArray(SIZE).fill(0);for(leti=0;i<SIZE;i++)for(letj=0;j<SIZE-i;j++)c[i]=c[i]+buf[j]*buf[j+i];letd=0;while(c[d]>c[d+1])d++;letmaxval=-1,maxpos=-1;for(leti=d;i<SIZE;i++)if(c[i]>maxval){maxval=c[i];maxpos=i;}constT0=maxpos;if(!T0)returnnull;constpitch=sampleRate/T0;if(pitch>1200||pitch<50)returnnull;returnpitch;}//=====Simplevoice'imitation'effect(pitch-shift+formant-ishfilter)=====asyncfunctionimitateVoice(){if(!voiceSample)returnalert('Subeunamuestradevozprimero.');constreader=newFileReader();reader.onload=async(ev)=>{try{constarrayBuffer=ev.target.result;constaudioCtx=audioCtxRef.current||new(window.AudioContext||window.webkitAudioContext)();constbuffer=awaitaudioCtx.decodeAudioData(arrayBuffer.slice(0));//CreateanOfflineAudioContexttorenderpitch-shiftedaudio(time-stretchnaive)constoffline=newOfflineAudioContext(buffer.numberOfChannels,buffer.length,buffer.sampleRate);constsrc=offline.createBufferSource();src.buffer=buffer;//simplepitchshiftviaplaybackRate(nothigh-quality)src.playbackRate.value=1.05;//smallshifttoimitateotravozconstbiquad=offline.createBiquadFilter();biquad.type='peaking';biquad.frequency.value=1200;biquad.gain.value=4;src.connect(biquad).connect(offline.destination);src.start(0);constrendered=awaitoffline.startRendering();//createblobandsetdownloadconstwav=audioBufferToWav(rendered);constblob=newBlob([newDataView(wav)],{type:'audio/wav'});consturl=URL.createObjectURL(blob);setDownloadUrl(url);consta=newAudio(url);a.play();}catch(err){console.error(err);alert('Errorprocesandolaimitaci√≥ndevoz.');}};reader.readAsArrayBuffer(voiceSample);}//helper:convertAudioBuffertoWAV(simpleinterleaved16-bit)functionaudioBufferToWav(buffer){constnumOfChan=buffer.numberOfChannels;constlength=buffer.length*numOfChan*2+44;constbuffer2=newArrayBuffer(length);constview=newDataView(buffer2);functionwriteString(view,offset,string){for(leti=0;i<string.length;i++)view.setUint8(offset+i,string.charCodeAt(i));}letoffset=0;writeString(view,offset,'RIFF');offset+=4;view.setUint32(offset,36+buffer.length*numOfChan*2,true);offset+=4;writeString(view,offset,'WAVE');offset+=4;writeString(view,offset,'fmt');offset+=4;view.setUint32(offset,16,true);offset+=4;view.setUint16(offset,1,true);offset+=2;view.setUint16(offset,numOfChan,true);offset+=2;view.setUint32(offset,buffer.sampleRate,true);offset+=4;view.setUint32(offset,buffer.sampleRate*numOfChan*2,true);offset+=4;view.setUint16(offset,numOfChan*2,true);offset+=2;view.setUint16(offset,16,true);offset+=2;writeString(view,offset,'data');offset+=4;view.setUint32(offset,buffer.length*numOfChan*2,true);offset+=4;//writeinterleaveddataconstchannels=[];for(leti=0;i<numOfChan;i++)channels.push(buffer.getChannelData(i));letpos=0;while(pos<buffer.length){for(leti=0;i<numOfChan;i++){letsample=Math.max(-1,Math.min(1,channels[i][pos]));//convertto16-bitPCMview.setInt16(offset,sample<0?sample*0x8000:sample*0x7fff,true);offset+=2;}pos++;}returnbuffer2;}//=====Downloadhelpers=====functiondownloadTabs(){constblob=newBlob([generated.tabs||"Sintablaturagenerada"],{type:'text/plain'});consturl=URL.createObjectURL(blob);consta=document.createElement('a');a.href=url;a.download='tablatura_docerola.txt';a.click();}asyncfunctiondownloadMidi(){if(!generated.notes||generated.notes.length===0)returnalert('Generalam√∫sicaprimero.');try{constmidiModule=awaitimport('https://cdn.jsdelivr.net/npm/midiwriter-js@2.1.0/build/index.umd.js');constMidiWriter=midiModule&&(midiModule.default||midiModule);if(!MidiWriter)thrownewError('Nosepudocargarmidiwriter-js');consttrack=newMidiWriter.Track();generated.notes.forEach((n)=>{constdur=n.dur==='4n'?'4':'8';constev=newMidiWriter.NoteEvent({pitch:[n.note],duration:dur});track.addEvent(ev);});constwrite=newMidiWriter.Writer([track]);constblob=newBlob([write.buildFile()],{type:'audio/midi'});consturl=URL.createObjectURL(blob);consta=document.createElement('a');a.href=url;a.download='docerola_song.mid';a.click();}catch(err){console.error(err);alert('ErroralgenerarMIDI:'+err.message);}}//=====RenderUI=====return(<divclassName="min-h-screenbg-gradient-to-brfrom-slate-900to-slate-800text-whitep-6"><divclassName="max-w-5xlmx-autobg-slate-900/60backdrop-blurrounded-2xlp-6shadow-lg"><headerclassName="flexitems-centerjustify-betweenmb-4"><h1className="text-3xlfont-extrabold">DocerolaStudioüé∏(12cuerdas)</h1><divclassName="text-smopacity-80">Todaslasherramientasenelnavegador‚Äîgratis</div></header><sectionclassName="gridmd:grid-cols-2gap-4"><divclassName="p-4bg-slate-800/40rounded-lg"><h2className="font-semibold">1)Generadorapartirdeletras</h2><textareaclassName="w-fullh-40mt-2p-2bg-slate-900rounded"value={lyrics}onChange={e=>setLyrics(e.target.value)}/><divclassName="flexgap-2mt-3"><selectvalue={scale}onChange={e=>setScale(e.target.value)}className="p-2roundedbg-slate-700"><optionvalue="G_major">Gmayor(sensibleadocerola)</option><optionvalue="E_minor">Emenor</option><optionvalue="A_minor">Amenor</option></select><inputtype="number"className="w-24p-2roundedbg-slate-700"value={bpm}onChange={e=>setBpm(Number(e.target.value))}/><buttonclassName="px-3py-2bg-emerald-500roundedtext-slate-900font-semibold"onClick={generateFromLyrics}>Generar</button><buttonclassName="px-3py-2bg-blue-500rounded"onClick={playGenerated}disabled={isPlaying}>{isPlaying?'Reproduciendo...':'Reproducir'}</button></div><divclassName="mt-3"><h3className="text-smopacity-80">Vistapreviadenotas(array)</h3><preclassName="bg-slate-900p-2roundedh-28overflow-auto">{JSON.stringify(generated.notes,null,2)}</pre></div></div><divclassName="p-4bg-slate-800/40rounded-lg"><h2className="font-semibold">2)Tablatura&Descarga</h2><pclassName="text-smopacity-80">Especializadoendocerola(guitarrade12cuerdas‚Äîpares).Generaunatablaturademostrativa.</p><preclassName="bg-slate-900p-3roundedh-48overflow-automt-3">{generated.tabs||'A√∫nnohaytablatura.Generalam√∫sicaprimero.'}</pre><divclassName="flexgap-2mt-3"><buttonclassName="px-3py-2bg-indigo-500rounded"onClick={downloadTabs}>DescargarTablatura</button><buttonclassName="px-3py-2bg-fuchsia-500rounded"onClick={downloadMidi}>DescargarMIDI</button></div></div><divclassName="p-4bg-slate-800/40rounded-lgmd:col-span-2"><h2className="font-semibold">3)An√°lisisdevozy'imitaci√≥n'(demo)</h2><pclassName="text-smopacity-80">Subeunamuestradevozparaanalizarelpitch.Laimitaci√≥naqu√≠esunares√≠ntesispitch-shiftsimple(todolocal).</p><divclassName="flexgap-2mt-2items-center"><inputtype="file"accept="audio/*"onChange={handleVoiceFile}/><divclassName="text-sm">Pitchdetectado:<strong>{pitchHz||'‚Äî'}</strong>Hz</div><buttonclassName="px-3py-2bg-amber-500rounded"onClick={imitateVoice}>Imitar(demo)</button>{downloadUrl&&<aclassName="px-3py-2bg-green-600rounded"href={downloadUrl}download="imitacion.wav">DescargarWAV</a>}</div><divclassName="mt-3text-xsopacity-75"><strong>Advertencia:</strong>Laimitaci√≥navanzadadevoz(clonaci√≥n)puedeimplicarriesgos√©ticos.Usamuestraspropiasypidepermisoantesdepublicarvocesdeotraspersonas.</div></div><divclassName="p-4bg-slate-800/40rounded-lgmd:col-span-2"><h2className="font-semibold">Extras&C√≥momejorar</h2><ulclassName="list-discml-5mt-2text-smopacity-90"><li>IntegrarMagenta.jsounmodelodeIAenservidorparamelod√≠asm√°smusicales.</li><li>Usarserviciosopen-sourcedeclonaci√≥ndevoz(conconsentimiento)enbackendparaimitaci√≥ndealtacalidad.</li><li>Agregareditordetablaturasinteractivoconvisualizaci√≥nde12cuerdasyexportadordePDF.</li></ul></div></section><footerclassName="mt-6text-smopacity-80">DocerolaStudio‚Ä¢Democliente‚ÄîRequiereconexi√≥naCDNparaTone.jsymidiwriter-js."Docerola"=guitarrade12cuerdas(docerola=guitarradedocecuerdas).Buscamosquetodofuncionegratuitamenteenelnavegador.</footer></div></div>);}/*Notasr√°pidasparasubiralaweb:-A√±adeTailwindCSSatuproyecto(oadaptaestilos).-Paraevitarproblemasconimportsdin√°micosenproducci√≥n,puedesa√±adirestasetiquetas<script>enpublic/index.html:<scriptsrc="https://cdn.jsdelivr.net/npm/tone@14.7.77/build/Tone.js"></script><scriptsrc="https://cdn.jsdelivr.net/npm/midiwriter-js@2.1.0/build/index.umd.js"></script>-Mejorasfuturas:calculartrastesrealesapartirdenotaMIDI,mostrarVexFlowparapartituras,editordetablaturasvisual.*/
<script src="DocerolaStudio.min.js"></script>
